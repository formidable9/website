<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Echo Unfiltered ‚Äì Skyboi Formidable</title>
  <style>
    /* === your existing styles (omitted for brevity) === */
  </style>
</head>
<body>
  <!-- === your existing HTML sections (header, slideshow, Ask AI, etc.) === -->

  <section class="ask-ai">
    <img src="logo.png" alt="Echo AI Logo" class="ai-logo">
    <h2>Ask AI</h2>
    <p>Ask Echo a question with your voice and hear her response.</p>
    <button id="ask-btn" class="cta" onclick="startVoiceAI()">Ask with Your Voice</button>
    <div id="ai-response">Click the button and speak your question.</div>
  </section>

  <!-- === rest of page === -->

  <script>
    function startVoiceAI(){
      const resp = document.getElementById('ai-response');
      resp.textContent = 'üé§ Listening‚Ä¶';
      const R = new (window.SpeechRecognition||window.webkitSpeechRecognition)();
      R.lang = 'en-GB'; R.start();

      R.onresult = async e => {
        const txt = e.results[0][0].transcript.trim();
        resp.textContent = `You said: ‚Äú${txt}‚Äù\nü§î Thinking‚Ä¶`;
        speechSynthesis.cancel();

        let out;
        try {
          const r = await fetch('/api/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: txt })
          });

          if (!r.ok) {
            // trap 405 (and any other) here
            if (r.status === 405) {
              out = "üîß Demo mode: Echo AI endpoint isn‚Äôt live yet.";
            } else {
              throw new Error(r.status);
            }
          } else {
            const j = await r.json();
            out = j.response;
          }
        } catch(err) {
          // network or unexpected
          out = `‚ùå Couldn‚Äôt reach AI (${err.message})`;
        }

        resp.textContent = `üéØ Echo: ${out}`;
        const U = new SpeechSynthesisUtterance(out);
        U.lang = 'en-GB';
        const v = speechSynthesis.getVoices()
                    .find(v=>v.lang==='en-GB' && /female/i.test(v.name));
        if (v) U.voice = v;
        U.rate = 1; U.pitch = 1.1;
        speechSynthesis.speak(U);
      };

      R.onerror = _=>{
        resp.textContent = '‚ùå Voice error‚Äîtry Chrome or Edge.';
      };
    }
  </script>
</body>
</html>
